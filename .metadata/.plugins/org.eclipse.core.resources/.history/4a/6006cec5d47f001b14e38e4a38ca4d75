<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mabatis.org//DTD Mapper 3.0//EN"
                       "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="main">
	<select id="getBizDailyStatusForMain" parameterType="java.lang.String" resultType="kr.co.hojeon.beans.BDListFromMainBean" >
		<![CDATA[
			SELECT
				M.BCD_CODE WORK_STATUS_CODE, M.BCD_NAME WORK_STATUS_NAME, M.SORT_NO, ISNULL(A.WORK_CNT, 0) WORK_CNT, B.ALL_CNT, ISNULL(A.WORK_CNT, 0) / B.ALL_CNT * 100 CNT_PERCENT
			FROM
				(SELECT BCD_CODE, BCD_NAME, SORT_NO FROM TB_BASE_DETAIL WITH(NOLOCK) WHERE BCH_CODE=  'W0002') M
				LEFT OUTER JOIN
					(
					SELECT WORK_STATUS, COUNT(*) WORK_CNT
					  FROM (SELECT BD_SEQ FROM TB_BIZDAILY_EXCUTER WITH(NOLOCK) WHERE EXC_USER = #{userid}) M,
					       TB_BIZDAILY_MASTER A WITH(NOLOCK) 
					 WHERE M.BD_SEQ = A.BD_SEQ AND A.WORK_STATUS <> '99999'
					GROUP BY A.WORK_STATUS
					) A
					ON M.BCD_CODE = A.WORK_STATUS
				LEFT OUTER JOIN
					(
					SELECT COUNT(*) ALL_CNT
					  FROM (SELECT BD_SEQ FROM TB_BIZDAILY_EXCUTER WITH(NOLOCK) WHERE EXC_USER = #{userid}) M,
					       TB_BIZDAILY_MASTER A WITH(NOLOCK) 
					 WHERE M.BD_SEQ = A.BD_SEQ AND A.WORK_STATUS <> '99999'
					) B
					ON 1 = 1
			ORDER BY M.SORT_NO
		]]>
	</select>
</mapper>
