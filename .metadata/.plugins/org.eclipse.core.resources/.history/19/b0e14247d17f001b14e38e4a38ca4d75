<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mabatis.org//DTD Mapper 3.0//EN"
                       "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="main">
	<select id="getBizDailyStatusForMain" parameterType="java.lang.String" resultType="kr.co.hojeon.beans.BDListFromMainBean" >
		<![CDATA[
			SELECT WORK_STATUS_CODE, WORK_STATUS_NAME, SORT_NO, WORK_CNT, ALL_CNT, WORK_CNT / ALL_CNT * 100 CNT_PERCENT
			  FROM (
					SELECT B.BCD_CODE WORK_STATUS_CODE, B.BCD_NAME WORK_STATUS_NAME, B.SORT_NO, COUNT(*) WORK_CNT, C.ALL_CNT
					  FROM (SELECT BD_SEQ FROM TB_BIZDAILY_EXCUTER WITH(NOLOCK) WHERE EXC_USER = #{userid}) M, TB_BIZDAILY_MASTER A WITH(NOLOCK), (SELECT BCD_CODE, BCD_NAME, SORT_NO FROM TB_BASE_DETAIL WITH(NOLOCK) WHERE BCH_CODE=  'W0002') B,
					       (
						   SELECT COUNT(*) ALL_CNT FROM (SELECT BD_SEQ FROM TB_BIZDAILY_EXCUTER WITH(NOLOCK) WHERE EXC_USER = #{userid}) M, TB_BIZDAILY_MASTER A WITH(NOLOCK) WHERE M.BD_SEQ = A.BD_SEQ AND A.WORK_STAUTS <> '99999'
						   ) C
					 WHERE M.BD_SEQ = A.BD_SEQ
					   AND A.WORK_STATUS = B.BCD_CODE
					GROUP BY B.BCD_CODE, B.BCD_NAME, B.SORT_NO
				    ) A
			ORDER BY SORT_NO
		]]>
	</select>
</mapper>
